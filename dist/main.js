(()=>{var e={371:(e,r,n)=>{n(738).config(Object.assign({},n(547),n(962)(process.argv)))},962:e=>{const r=/^dotenv_config_(encoding|path|debug|override)=(.+)$/;e.exports=function(e){return e.reduce((function(e,n){const t=n.match(r);return t&&(e[t[1]]=t[2]),e}),{})}},547:e=>{const r={};null!=process.env.DOTENV_CONFIG_ENCODING&&(r.encoding=process.env.DOTENV_CONFIG_ENCODING),null!=process.env.DOTENV_CONFIG_PATH&&(r.path=process.env.DOTENV_CONFIG_PATH),null!=process.env.DOTENV_CONFIG_DEBUG&&(r.debug=process.env.DOTENV_CONFIG_DEBUG),null!=process.env.DOTENV_CONFIG_OVERRIDE&&(r.override=process.env.DOTENV_CONFIG_OVERRIDE),e.exports=r},738:(e,r,n)=>{const t=n(147),o=n(17),s=n(37),i=/(?:^|^)\s*(?:export\s+)?([\w.-]+)(?:\s*=\s*?|:\s+?)(\s*'(?:\\'|[^'])*'|\s*"(?:\\"|[^"])*"|\s*`(?:\\`|[^`])*`|[^#\r\n]+)?\s*(?:#.*)?(?:$|$)/gm;function a(e){console.log(`[dotenv][DEBUG] ${e}`)}const c={config:function(e){let r=o.resolve(process.cwd(),".env"),n="utf8";const i=Boolean(e&&e.debug),d=Boolean(e&&e.override);var u;e&&(null!=e.path&&(r="~"===(u=e.path)[0]?o.join(s.homedir(),u.slice(1)):u),null!=e.encoding&&(n=e.encoding));try{const e=c.parse(t.readFileSync(r,{encoding:n}));return Object.keys(e).forEach((function(r){Object.prototype.hasOwnProperty.call(process.env,r)?(!0===d&&(process.env[r]=e[r]),i&&a(!0===d?`"${r}" is already defined in \`process.env\` and WAS overwritten`:`"${r}" is already defined in \`process.env\` and was NOT overwritten`)):process.env[r]=e[r]})),{parsed:e}}catch(e){return i&&a(`Failed to load ${r} ${e.message}`),{error:e}}},parse:function(e){const r={};let n,t=e.toString();for(t=t.replace(/\r\n?/gm,"\n");null!=(n=i.exec(t));){const e=n[1];let t=n[2]||"";t=t.trim();const o=t[0];t=t.replace(/^(['"`])([\s\S]*)\1$/gm,"$2"),'"'===o&&(t=t.replace(/\\n/g,"\n"),t=t.replace(/\\r/g,"\r")),r[e]=t}return r}};e.exports.config=c.config,e.exports.parse=c.parse,e.exports=c},147:e=>{"use strict";e.exports=require("fs")},37:e=>{"use strict";e.exports=require("os")},17:e=>{"use strict";e.exports=require("path")}},r={};function n(t){var o=r[t];if(void 0!==o)return o.exports;var s=r[t]={exports:{}};return e[t](s,s.exports,n),s.exports}n.n=e=>{var r=e&&e.__esModule?()=>e.default:()=>e;return n.d(r,{a:r}),r},n.d=(e,r)=>{for(var t in r)n.o(r,t)&&!n.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:r[t]})},n.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r),(()=>{"use strict";n(371);const e=require("node:http"),r=require("crypto");var t=n.n(r);const o=new Uint8Array(256);let s=o.length;function i(){return s>o.length-16&&(t().randomFillSync(o),s=0),o.slice(s,s+=16)}const a=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,c=function(e){return"string"==typeof e&&a.test(e)},d=[];for(let e=0;e<256;++e)d.push((e+256).toString(16).substr(1));const u=function(e,r,n){const t=(e=e||{}).random||(e.rng||i)();if(t[6]=15&t[6]|64,t[8]=63&t[8]|128,r){n=n||0;for(let e=0;e<16;++e)r[n+e]=t[e];return r}return function(e,r=0){const n=(d[e[r+0]]+d[e[r+1]]+d[e[r+2]]+d[e[r+3]]+"-"+d[e[r+4]]+d[e[r+5]]+"-"+d[e[r+6]]+d[e[r+7]]+"-"+d[e[r+8]]+d[e[r+9]]+"-"+d[e[r+10]]+d[e[r+11]]+d[e[r+12]]+d[e[r+13]]+d[e[r+14]]+d[e[r+15]]).toLowerCase();if(!c(n))throw TypeError("Stringified UUID is invalid");return n}(t)},h=require("node:cluster");var l=n.n(h);const g=require("node:os");function f(e,r,n,t){return o=this,s=void 0,a=function*(){const o=["age","hobbies","username","id"];let s="";switch(r.method){case"POST":r.on("data",(r=>{const s=JSON.parse(r.toString());try{if(Object.keys(s).filter((e=>!o.includes(e))).length>0)throw new Error("An object can only have age, name and hobbies keys");if(n[2])throw new Error("Ð¡ant add custom id to POST request");!function(e,r,n){if(r.id)throw new Error("ID cannot be created by user");if(!r.username||!r.age||!r.hobbies||r.hobbies.length<0)throw new Error("username, age, hobbies is require");if(!Array.isArray(r.hobbies)||"string"!=typeof r.username||"number"!=typeof r.age)throw new Error("username must be string, age must be number, hobbies must be array of string");try{const t=n.addPerson(r.username,r.age,r.hobbies);e.writeHead(201),e.end(JSON.stringify(t))}catch(r){e.writeHead(500),e.end("Something wrong on server")}}(e,s,t)}catch(r){e.writeHead(400),r instanceof Error?e.end(r.message):e.end("Something wrong with error handling")}})),r.on("close",(()=>{e.headersSent||(e.writeHead(400),e.end("The body cannot be empty"))}));break;case"GET":try{if(n[2]){if(!c(n[2])){e.writeHead(400),e.end("ID is not valid (not uuid)");break}s=n[2]}!function(e,r,n){try{if(r&&""!==r){const t=JSON.stringify(n.getPersons(r));e.writeHead(200),e.end(t)}else{const r=JSON.stringify(n.getPersons(""));e.writeHead(200),e.end(r)}}catch(r){e.writeHead(404),r instanceof Error?e.end(r.message):e.end("Something wrong with error handling")}}(e,s,t)}catch(r){e.writeHead(400),r instanceof Error?e.end(r.message):e.end("Something wrong with error handling")}break;case"PUT":r.on("data",(r=>{try{if(console.log(n[2],c(n[2])),!n[2])throw new Error("ID required to change person values");if(!c(n[2]))throw new Error("ID is not valid (not uuid)");const s=JSON.parse(r.toString("utf8"));if(Object.keys(s).filter((e=>!o.includes(e))).length>0)throw new Error("An object can only have age, name and hobbies keys");s.id=n[2],function(e,r,n){try{if(r.hobbies&&!Array.isArray(r.hobbies))throw new Error("username must be string, age must be number, hobbies must be array of string");if(r.username&&"string"!=typeof r.username)throw new Error("username must be string, age must be number, hobbies must be array of string");if(r.age&&"number"!=typeof r.age)throw new Error("username must be string, age must be number, hobbies must be array of string");const t=n.putPerson(r.id,r.username,r.age,r.hobbies);e.writeHead(200),e.end(JSON.stringify(t))}catch(r){e.writeHead(404),r instanceof Error?e.end(r.message):e.end("Something wrong with error handling")}}(e,s,t)}catch(r){e.writeHead(400),r instanceof Error?e.end(r.message):e.end("Something wrong with error handling")}})),r.on("close",(()=>{e.headersSent||(e.writeHead(400),e.end("The body cannot be empty"))}));break;case"DELETE":try{if(!n[2])throw new Error("ID required to change person values");c(n[2])?function(e,r,n){try{if(!n.checkPerson(r))throw new Error("Person with this id was not found");n.deletePerson(r),e.writeHead(200),e.end("User deleted")}catch(r){e.writeHead(404),r instanceof Error?e.end(r.message):e.end("Something wrong with error handling")}}(e,n[2],t):(e.writeHead(400),e.end("ID is not valid (not uuid)"))}catch(r){e.writeHead(400),r instanceof Error?e.end(r.message):e.end("Something wrong with error handling")}break;default:e.writeHead(400),e.end("Unsupported method")}},new((i=void 0)||(i=Promise))((function(e,r){function n(e){try{c(a.next(e))}catch(e){r(e)}}function t(e){try{c(a.throw(e))}catch(e){r(e)}}function c(r){var o;r.done?e(r.value):(o=r.value,o instanceof i?o:new i((function(e){e(o)}))).then(n,t)}c((a=a.apply(o,s||[])).next())}));var o,s,i,a}const p=require("node:process");const w=new class{constructor(){this.persons=[]}addPerson(e,r,n){const t={id:u(),username:e,age:r,hobbies:n};return this.persons.push(t),t}getPersons(e){if(""!==e){const r=this.persons.findIndex((r=>r.id===e));if(r>=0)return this.persons[r];throw new Error("User with this id is not included")}return this.persons}putPerson(e,r,n,t){const o=this.persons.find((r=>r.id===e));if(o)return r&&(o.username=r),n&&(o.age=n),t&&(o.hobbies=t),this.persons=this.persons.map((e=>e.id===o.id?o:e)),this.getPersons(e);throw new Error("User with this id is not included")}deletePerson(e){const r=this.persons.filter((r=>r.id!==e));this.persons=r}checkPerson(e){return this.persons.filter((r=>r.id===e)).length>0}},b=e.createServer();"--cluster=multi"===process.argv.slice(2)[0]?function(e,r){if(l().isWorker){const n=Number(p.env.PORT?p.env.PORT:5e3);e.listen(n,(()=>console.log(`Server is running on http://localhost:${n}; Worker pid: ${p.pid}`))),function(e,r){e.on("request",((e,n)=>{return t=this,o=void 0,i=function*(){console.log(`Worker with pid: ${p.pid} handling request`);const t=e.url?e.url.split("/").slice(1):[];if("users"!==t[1]||t.length>3||"api"!==t[0]||t.length<2)n.writeHead(404),n.end("Not supported path");else try{yield f(n,e,t,r)}catch(e){console.log(e),n.writeHead(500),n.end("App was broken")}n.getHeaders()||(n.writeHead(404),n.end("Body is empty"))},new((s=void 0)||(s=Promise))((function(e,r){function n(e){try{c(i.next(e))}catch(e){r(e)}}function a(e){try{c(i.throw(e))}catch(e){r(e)}}function c(r){var t;r.done?e(r.value):(t=r.value,t instanceof s?t:new s((function(e){e(t)}))).then(n,a)}c((i=i.apply(t,o||[])).next())}));var t,o,s,i}))}(e,r)}else{const e=g.cpus().length;for(let r=0;r<e;r++)l().fork()}}(b,w):function(e,r){const n=Number(process.env.PORT?process.env.PORT:5e3);e.listen(n,(()=>console.log(`Server is running on http://localhost:${n}`))),e.on("request",((e,n)=>{return t=this,o=void 0,i=function*(){const t=e.url?e.url.split("/").slice(1):[];if("users"!==t[1]||t.length>3||"api"!==t[0]||t.length<2)n.writeHead(404),n.end("Not supported path");else try{f(n,e,t,r)}catch(e){console.log(e),n.writeHead(500),n.end("App was broken")}n.getHeaders()||(n.writeHead(404),n.end("Body is empty"))},new((s=void 0)||(s=Promise))((function(e,r){function n(e){try{c(i.next(e))}catch(e){r(e)}}function a(e){try{c(i.throw(e))}catch(e){r(e)}}function c(r){var t;r.done?e(r.value):(t=r.value,t instanceof s?t:new s((function(e){e(t)}))).then(n,a)}c((i=i.apply(t,o||[])).next())}));var t,o,s,i}))}(b,w)})()})();